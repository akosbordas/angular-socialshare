"use strict";function debounce(e,t,n){var r;return function(){var o=this,i=arguments,c=function(){r=null,n||e.apply(o,i)},a=n&&!r;clearTimeout(r),r=setTimeout(c,t),a&&e.apply(o,i)}}function randomString(e,t){t=t&&t.toLowerCase();for(var n="",r=0,o="a"==t?10:0,i="n"==t?10:62;r++<e;){var c=Math.random()*(i-o)+o<<0;n+=String.fromCharCode(c+=c>9?36>c?55:61:48)}return n}angular.module("djds4rce.angular-socialshare",["djds4rce.angular-socialshare.templates"]).factory("TemplateService",["$q","$templateCache","$compile","$http",function(e,t,n,r){return{fetchTemplate:function(n){return e.when(t.get(n)||r.get(n)).then(function(e){return angular.isObject(e)?(t.put(n,e.data),e.data):e})},compileAndAppendContent:function(e,t){this.fetchTemplate(e.templateUrl).then(function(r){t.empty(),t.append(r),n(t.contents())(e)})}}}]).factory("$FB",["$window",function(e){return{init:function(t){if(!t)throw"FB App Id Cannot be blank";this.fbId=t,e.fbAsyncInit=function(){FB.init({appId:t,channelUrl:"app/channel.html",status:!0,xfbml:!0})},function(e){var t,n="facebook-jssdk",r=e.getElementsByTagName("script")[0];e.getElementById(n)||(t=e.createElement("script"),t.id=n,t.async=!0,t.src="//connect.facebook.net/en_US/all.js",r.parentNode.insertBefore(t,r))}(document)}}}]).directive("facebook",["$http",function(e){return{scope:{callback:"=",shareButtonText:"=?",templateUrl:"=?",shares:"="},transclude:!0,templateUrl:"templates/facebook-share.html",link:function(t,n,r){t.shareButtonText=t.shareButtonText||"Share",t.templateUrl&&TemplateService.compileAndAppendContent(t,n),r.$observe("url",function(){r.shares&&r.url&&e.get("https://api.facebook.com/method/links.getStats?urls="+r.url+"&format=json").success(function(e){var n=e[0]&&e[0].total_count?e[0].total_count.toString():0,r="";n.length>6?("0"!=n.slice(-6,-5)&&(r="."+n.slice(-6,-5)),n=n.slice(0,-6),n=n+r+"M"):n.length>3&&("0"!=n.slice(-3,-2)&&(r="."+n.slice(-3,-2)),n=n.slice(0,-3),n=n+r+"k"),t.shares=n}).error(function(){t.shares=0}),n.unbind(),n.bind("click",function(e){FB.ui({method:"share",href:r.url},function(e){void 0!==t.callback&&"function"==typeof t.callback&&t.callback(e)}),e.preventDefault()})})}}}]).directive("facebookFeedShare",["$http","TemplateService",function(e,t){return{scope:{callback:"=",shareButtonText:"=?",templateUrl:"=?",shares:"="},transclude:!0,templateUrl:"templates/facebook-feed-share.html",link:function(n,r,o){n.shareButtonText=n.shareButtonText||"Share",n.templateUrl&&t.compileAndAppendContent(n,r),o.$observe("url",function(){o.shares&&o.url&&e.get("https://api.facebook.com/method/links.getStats?urls="+o.url+"&format=json").success(function(e){var t=e[0]?e[0].total_count.toString():0,r="";t.length>6?("0"!=t.slice(-6,-5)&&(r="."+t.slice(-6,-5)),t=t.slice(0,-6),t=t+r+"M"):t.length>3&&("0"!=t.slice(-3,-2)&&(r="."+t.slice(-3,-2)),t=t.slice(0,-3),t=t+r+"k"),n.shares=t}).error(function(){n.shares=0}),r.unbind(),r.bind("click",function(e){FB.ui({method:"feed",link:o.url,picture:o.picture,name:o.name,caption:o.caption,description:o.description},function(e){void 0!==n.callback&&"function"==typeof n.callback&&n.callback(e)}),e.preventDefault()})})}}}]).directive("twitter",["$timeout",function(e){return{link:function(t,n,r){var o=debounce(function(){r.url&&e(function(){n[0].innerHTML="",twttr.widgets.createShareButton(r.url,n[0],function(){},{count:r.count,text:r.text,via:r.via,size:r.size})})},75);r.$observe("url",o),r.$observe("text",o)}}}]).directive("linkedin",["$timeout","$http","$window",function(e,t,n){return{scope:{shares:"=",shareButtonText:"=?",templateUrl:"=?"},transclude:!0,templateUrl:"templates/linkedin-share.html",link:function(r,o,i){r.shareButtonText=r.shareButtonText||"Share",r.templateUrl&&TemplateService.compileAndAppendContent(r,o);var c=debounce(function(){i.shares&&i.url&&t.jsonp("https://www.linkedin.com/countserv/count/share?url="+i.url+"&callback=JSON_CALLBACK&format=jsonp").success(function(e){r.shares=e.count.toLocaleString()}).error(function(){r.shares=0}),e(function(){o.unbind(),o.bind("click",function(){var e=encodeURIComponent(i.url).replace(/'/g,"%27").replace(/"/g,"%22");n.open("//www.linkedin.com/shareArticle?mini=true&url="+e+"&title="+i.title+"&summary="+i.summary)})})},100);i.$observe("url",c),i.$observe("title",c),i.$observe("summary",c)}}}]).directive("gplus",[function(){return{link:function(e,t,n){var r=debounce(function(){"undefined"==typeof gapi?!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://apis.google.com/js/platform.js",e.onload=o;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}():o()},100),o=function(e,n){return function(){var e=document.createElement("div"),r=n.id||randomString(5);n.id=r,e.setAttribute("id",r),t.innerHTML="",t.append(e),n["class"]&&-1!=n["class"].indexOf("g-plusone")?window.gapi.plusone.render(r,n):window.gapi.plus.render(r,n)}}(t,n);n.$observe("href",r)}}}]).directive("tumblrText",[function(){return{link:function(e,t,n){var r=document.createElement("a"),o=debounce(function(){r.setAttribute("href","https://www.tumblr.com/share/link?url="+encodeURIComponent(n.url)+"&name="+encodeURIComponent(n.name)+"&description="+encodeURIComponent(n.description)),r.setAttribute("title",n.title||"Share on Tumblr"),r.setAttribute("style",n.styling||"display:inline-block; text-indent:-9999px; overflow:hidden; width:81px; height:20px; background:url('https://platform.tumblr.com/v1/share_1.png') top left no-repeat transparent;"),t[0].innerHTML="",t.append(r)},100);n.$observe("url",o),n.$observe("name",o),n.$observe("description",o)}}}]).directive("tumblrQoute",[function(){return{link:function(e,t,n){var r=document.createElement("a"),o=debounce(function(){r.setAttribute("href","https://www.tumblr.com/share/quote?quote="+encodeURIComponent(n.qoute)+"&source="+encodeURIComponent(n.source)),r.setAttribute("title",n.title||"Share on Tumblr"),r.setAttribute("style",n.styling||"display:inline-block; text-indent:-9999px; overflow:hidden; width:81px; height:20px; background:url('https://platform.tumblr.com/v1/share_1.png') top left no-repeat transparent;"),t[0].innerHTML="",t.append(r)},100);n.$observe("qoute",o),n.$observe("source",o)}}}]).directive("tumblrImage",[function(){return{link:function(e,t,n){var r=document.createElement("a"),o=debounce(function(){r.setAttribute("href","https://www.tumblr.com/share/photo?source="+encodeURIComponent(n.source)+"&caption="+encodeURIComponent(n.caption)+"&clickthru="+encodeURIComponent(n.clickthru)),r.setAttribute("title",n.title||"Share on Tumblr"),r.setAttribute("style",n.styling||"display:inline-block; text-indent:-9999px; overflow:hidden; width:81px; height:20px; background:url('https://platform.tumblr.com/v1/share_1.png') top left no-repeat transparent;"),t[0].innerHTML="",t.append(r)},100);n.$observe("source",o),n.$observe("caption",o),n.$observe("clickthru",o)}}}]).directive("tumblrVideo",[function(){return{link:function(e,t,n){var r=document.createElement("a"),o=debounce(function(){r.setAttribute("href","https://www.tumblr.com/share/video?embed="+encodeURIComponent(n.embedcode)+"&caption="+encodeURIComponent(n.caption)),r.setAttribute("title",n.title||"Share on Tumblr"),r.setAttribute("style",n.styling||"display:inline-block; text-indent:-9999px; overflow:hidden; width:81px; height:20px; background:url('https://platform.tumblr.com/v1/share_1.png') top left no-repeat transparent;"),t[0].innerHTML="",t.append(r)},100);n.$observe("embedcode",o),n.$observe("caption",o)}}}]).directive("pintrest",["$window","$timeout",function(e,t){return{scope:{templateUrl:"=?"},templateUrl:"templates/pintrest-share.html",link:function(n,r,o){n.templateUrl&&TemplateService.compileAndAppendContent(n,r);var i=debounce(function(){var n=document.createElement("a");n.setAttribute("href","//www.pinterest.com/pin/create/button/?url="+encodeURIComponent(o.href)+"&media="+encodeURIComponent(o.img)+"&description="+encodeURIComponent(o.description)),n.setAttribute("pinDo",o.pinDo||"buttonPin"),n.setAttribute("pinConfig",o.pinConfig||"beside"),r[0].innerHTML="",r.append(n),t(function(){e.parsePins(r)})},100);o.$observe("href",i),o.$observe("img",i),o.$observe("description",i)}}}]);